# MySQL基础知识

## 存储引擎

`MySQL`实现了插拔式存储引擎，最常见的两种是`InnoDB`和`MyISAM`。

#### InnoDB

`InnoDB`是默认的事务型存储引擎，使用较为广泛。

- 数据存储形式

  - `.frm` 存储表结构。
  - `.ibd`存储表的数据和索引。

- 锁的粒度

  `InnoDB`采用了`MVCC`（多版本并发控制）来支持高并发，支持行锁。

- 事务

   `InnoDB`是典型的事务引擎。

  实现了四个事务的隔离级别：

  - 读未提交
  - 读已提交
  - 可重复读（默认）
  - 串行化读

- 数据的存储特点

  基于**聚簇索引**建立，即在`B+树`的叶子节点缓存有索引的整行记录的所有数据（只有一个`.ibd`）。

  建议使用自增整数作为主键索引。

  - 使用整数相较`UUID`占用内存小，也易于比较。
  - 使用自增，减少出现索引是插入的需要树重排消耗额外性能的问题。

  

#### MyISAM

在快速查询和单就数据库的全文检索而言，选用`MyISAM`，其他情况多使用`InnoDB`。

- 数据存储形式

  - `.frm`存储表结构。
  - `MYD` 存储表的数据。
  - `MYI`存储表索引。

- 锁的粒度

  不支持行锁，读取数据的时候对表加上共享锁，写入的时候加上排他锁。

  对整表加锁，所以并发写入的效率相较`InnoDB`很低。

- 事务

  不支持事务。

-  数据的存储特点

  **非聚簇索引**，叶子节点只缓存索引信息，需要通过索引信息再去找到数据（有`.MYD`,`.MYI`）。



## 索引

### 索引类型

普通索引，主键索引，唯一索引，组合索引，全文索引。

>覆盖索引，SELECT的数据列只从索引中就能够取得，不必读取数据行，即所查询的列要被所建的索引覆盖。



### 索引使用

#### 最左匹配原则

在使用组合索引时，会按照索引的顺序从左往右进行排序。一般当被排序的索引是无序时无法命中索引。

以最左边的条件为起点任何连续的索引都能匹配上，=和in可以乱序，`MySQL`优化器会优化语句。

在索引匹配条件中遇到范围查询(`>、<、between、like`)就会停止匹配右侧的索引。

> 当`MySQL`认为全表扫描比使用索引快时，也会不使用索引。

## SQL优化

#### 覆盖索引

即在可以的条件下尽量使用索引可以覆盖的语句进行查询，避免使用`SELECT *`。

#### EXPLAIN

`explain`是一个神奇的命令，可以查看`sql`的具体的执行计划并进行针对优化。


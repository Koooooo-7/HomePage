# Redis基础

## 概述

> Redis，一个用起来很快乐，面试起来可能不太快乐的玩意。:dog:
>
> 这也个算是对`《Redis 设计与实现》`的部分读书笔记吧。

`Redis`是一个通常被用来用作缓存的`K-V`存储的`NoSQL`数据库。

## 基础知识

#### 数据类型

`Redis`的数据类型一般来说有以下几种。

- `String`

  但是支持数字加减运算。（是不是很像`MySQL`）

- `List`

  同时兼具队列作用，一般是`LPUSH`和`RPOP`配合食用。:bow:

- `Set`

  存储Set集合，具有`isContain`方法快速检测。

- `ZSet(SortedSet)`

  有序Set，可以通过`Score`参数进行排序，可以做最热TopN相关的业务实现。

- `Hash`

  其实感觉应该说是一个结构体`struct`比较好。

  > 这里还有一个`hashtag`的概念，可以对相关的key（比如含有相同的前缀）的分区存储时指定`hashtag`来存在一个地方(`solt`)。

  

> 扩展部分

##### 布隆过滤器（`BloomFilter`）

布隆过滤器其实并不陌生，毕竟当初也是用`MATLAB`干过的。:dog:

布隆过滤器主要是用于判断一个元素是否在集合中。基于对数据进行hash后采样来处理，但因为hash碰撞的原因，具有一定的误判率。但是如果是判断一个元素是否不存在在集合中，这是可以保证的。

但是布隆过滤器是不支持删除元素的，因为并没有存储key，知识直接把数据映射到了数组中。

>  扩展优化的过滤器：布谷鸟过滤器。



## 业务应用

几个基础概念和解决办法。

- 缓存穿透

  概念： 被请求查询一些不存在的key，这时候因为没有缓存命中，那会打到DB上，如果是恶意的频繁请求，这样肯定是不行的。

  解决办法：

  - 暂时缓存这些没有查到的key，这样让缓存命中，返回空值或者默认设置的值。
  - 布隆过滤器作为前置缓存检查，如果缓存中没有，直接返回。

- 缓存击穿

  概念：一般来说是对热点数据（热点`key`）有大量请求访问时，缓存突然失效，这时候大量的请求打到了DB上。

  解决办法：

  - 热点数据缓存永不过期。（如果业务没有强缓存一致性问题的话。）
  - 多份缓存，即对热点数据设置不同的过期时间，有一个`缓存备份`，交替更新。
  - 缓存失效时进入数据库请求部分进行加锁，只有拿到锁的线程才能去请求数据库并生成缓存，其他线程去缓存中读取（`锁内double check`）。

- 缓存雪崩

  - 热点数据集中失效

  ​      很多key同时失效，导致缓存大面积失效，请求都打到DB上。

  解决办法：对不同的key设置不同的失效事件，在预设的失效时间上进行一定程度的散列分布，比如一组一个小时失效的，可以在设置失效时间在`1小时~1小时10分`之间。

  - 服务宕机

    服务突然宕机导致缓存不可用，请求到打到DB上。

    这样的情况涉及到的就是高可用的情。

    - 可以通过搭建集群提高可用性来解决这个问题。
    - 通过本地缓存和熔断降级进行应用保护等待故障恢复。

    

    

## 集群运维

#### 备份恢复

##### RDB

##### AOF

#### 选举

#### Hash环/槽

#### 脑裂

